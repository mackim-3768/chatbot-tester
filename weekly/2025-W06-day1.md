# Daily Framework Planning – 2025-W06-day1

> Repository: chatbot-tester
> Type: Library / SDK (Generator · Runner · Evaluator)
> Cadence: Daily (주차 내 일차별 사고 기록)
> Focus: Architecture, API design, extensibility, reproducibility

---

## Language Rule (MANDATORY)

- 본 문서의 **모든 내용은 반드시 한국어로 작성**합니다.
- 다음 항목만 예외적으로 영어 사용을 허용합니다:
  - 코드 블록
  - 파일 경로
  - 함수명 / 클래스명 / 모듈명
  - CLI 커맨드
  - 고유 명사 (예: OpenAI, CLI, SDK, Generator, Runner, Evaluator)
- 번역체가 아닌 **기술 기획 문서에 적합한 자연스러운 한국어**를 사용합니다.

---

## 1. Discovery (Ideas)

> Goal: 재사용 가능한 SDK 관점에서의 프레임워크 수준 개선 아이디어를
> **하루 단위로 축적**한다.

### Idea 1
- Affected layer: Common
- Current limitation: `Message`와 `TestSample` 같은 핵심 데이터 모델이 `generator`와 `runner` 모듈에 중복 정의되어 있습니다. 이는 코드 중복을 초래하고 모듈 간 데이터 교환 시 호환성 문제를 일으킬 수 있습니다.
- Proposed improvement: `chatbot_tester.common.models` 패키지를 신설하여 공통 데이터 모델을 이곳으로 이동시키고 단일 진실 공급원(Single Source of Truth)으로 관리합니다.
- Why this matters for an SDK: 핵심 데이터 구조의 일관성은 SDK의 안정성과 사용성을 보장하는 데 필수적입니다. 또한, 향후 `Evaluator` 모듈이 통합될 때 동일한 데이터 구조를 공유해야 하므로 필수적인 구조 개선입니다.

### Idea 2
- Affected layer: Runner / Evaluator / Common
- Current limitation: `ChatBackend`와 `BackendRegistry`가 `runner` 모듈 내부에 위치하고 있어, `evaluator` 모듈에서 LLM 기반 평가(Judge)를 수행할 때 백엔드 로직을 재사용하기 어렵습니다.
- Proposed improvement: 백엔드 관련 로직을 `chatbot_tester.common.backends`로 이동하여 `runner`와 `evaluator` 모두 접근 가능하게 만듭니다.
- Why this matters for an SDK: 코드 재사용성을 높이고 모듈 간 결합도를 낮추어 확장성을 개선합니다.

### Idea 3
- Affected layer: Common
- Current limitation: `RunResultStatus` 열거형이 `runner`에만 정의되어 있어, 평가 및 리포팅 단계에서 실행 상태를 참조할 때 의존성 문제가 발생할 수 있습니다.
- Proposed improvement: 실행 상태 정의를 `common.models`로 이동하여 전체 파이프라인에서 공유하도록 합니다.
- Why this matters for an SDK: 실행 결과의 상태 관리는 파이프라인 전반에 걸쳐 일관되게 처리되어야 합니다.

### Idea 4
- Affected layer: Common
- Current limitation: `DatasetInfo`가 `runner`에 정의되어 있지만, 실제 데이터셋 생성 정보는 `generator`에서 관리되는 경우가 많아 정보의 불일치가 발생할 수 있습니다.
- Proposed improvement: `DatasetInfo`를 `common.models`로 이동하여 생성 단계부터 실행 단계까지 메타데이터 흐름을 통일합니다.
- Why this matters for an SDK: 데이터셋의 생성부터 실행 결과까지의 추적성(Traceability)을 확보하기 위해 메타데이터 구조의 통일이 필요합니다.

---

## 2. Triage

> Goal: **오늘 기준** 가장 아키텍처적 파급력이 큰 1개 아이디어를 선정한다.

### Selected Idea
- Title: `Message` 및 `TestSample` 모델을 `chatbot_tester.common.models`로 리팩토링
- Primary affected layer(s): Generator, Runner, Evaluator, Common

### Selection Rationale
- Architectural leverage: 가장 기본이 되는 데이터 모델의 중복을 제거함으로써, 향후 모든 기능 확장의 기초를 단단히 합니다.
- Impact on extensibility / reuse: 모듈 간의 순환 참조 문제를 예방하고, `Evaluator` 등 다른 모듈이 데이터 모델을 쉽게 재사용할 수 있게 합니다.
- Reduction of future complexity: 데이터 모델 변경 시 여러 곳을 수정해야 하는 유지보수 부담을 줄입니다.

### Deferred Ideas (Brief)
- Idea 2 (Backend extraction): 모델 리팩토링이 선행되어야 백엔드 인터페이스 정의도 명확해지므로 다음 순위로 미룹니다.
- Idea 3 & 4 (Status & DatasetInfo): Idea 1과 같은 맥락이므로, `common` 패키지 구조가 잡힌 후 순차적으로 진행합니다.

---

## 3. Spec Draft (Top 1 Only)

### Feature / Improvement Name
공통 데이터 모델 (`Message`, `TestSample`) 분리 및 `common` 패키지 신설

### Problem Statement
- 현재 어떤 점이 어렵거나, 불명확하거나, 오류를 유발하는가?
  - `generator/types.py`와 `runner/models.py`에 `Message`, `TestSample` 클래스가 중복 정의되어 있습니다.
  - 두 정의 간에 필드나 메서드(`to_dict`, `from_dict`)의 불일치가 발생할 가능성이 큽니다.
  - `runner` 모듈이 `generator`의 타입을 참조하거나 그 반대의 경우 순환 참조(Circular Dependency)가 발생할 수 있습니다.
- 누구에게 영향을 주는가? (라이브러리 사용자 / CLI 사용자 / 프레임워크 유지보수자)
  - 프레임워크 유지보수자: 코드 중복 관리의 어려움.
  - 라이브러리 사용자: 모듈 간 데이터 호환성 혼란.

### Design Approach (High-level)
- Core concept: `src/chatbot_tester/common/models.py`를 생성하여 핵심 데이터 클래스를 정의합니다.
- Key abstractions or interfaces:
  - `Message`: 대화 메시지 구조.
  - `TestSample`: 테스트 케이스 구조.
  - `DatasetInfo`, `RunResultStatus` 등 연관 모델도 함께 이동 고려.
- Expected behavior: 기존 `generator`와 `runner` 코드는 `common.models`를 임포트하여 사용하며, 기능적 변화 없이 내부 구조만 개선됩니다.

### MVP Scope
- Included in MVP:
  - `src/chatbot_tester/common/models.py` 생성.
  - `Message`, `TestSample`, `DatasetInfo`, `RunResultStatus` 클래스 이동.
  - `generator/types.py` 및 `runner/models.py`에서 `common` 임포트로 변경 (또는 해당 파일 제거 후 참조 수정).
- Explicitly excluded:
  - `Backend` 관련 클래스 이동 (별도 이슈로 처리).

### Optional / Future Extensions
- `pydantic` 모델로 전환하여 유효성 검사 강화.

### Acceptance Criteria
- [ ] `src/chatbot_tester/common` 패키지가 생성되어야 함.
- [ ] `Message`, `TestSample`이 `common.models`에 정의되어야 함.
- [ ] `generator`와 `runner`의 테스트가 수정 없이(또는 임포트 경로만 수정하여) 통과해야 함.
- [ ] 순환 참조 에러가 발생하지 않아야 함.

---

## 4. Backlog Draft (Issue-Level)

### Suggested GitHub Issue Title
`[Framework][Refactor] 공통 데이터 모델 common 패키지로 분리`

### Task Breakdown
- [ ] Core implementation
  - Module: `common`
  - Summary: `src/chatbot_tester/common/models.py` 생성 및 데이터 클래스 이관.
- [ ] Refactoring
  - Module: `runner`
  - Summary: `runner/models.py`에서 로컬 정의를 제거하고 `common.models` 임포트 및 재내보내기(Re-export) 적용.
  - Module: `generator`
  - Summary: `generator/types.py`에서 로컬 정의를 제거하고 `common.models` 임포트.
- [ ] API impact
  - Breaking change: No (기존 경로에서 re-export를 통해 하위 호환성 유지 권장).
  - Migration needed: No.
- [ ] Tests
  - Unit / Integration: 기존 테스트 수행하여 회귀 테스트 진행.

### Notes
- Backward compatibility concerns: `runner.models`와 `generator.types`에서 `from chatbot_tester.common.models import ...` 형태로 클래스를 노출시켜 기존 import 경로가 깨지지 않도록 해야 합니다.
- Refactoring risk: 타입 힌트 순환 참조 주의 (`TYPE_CHECKING` 블록 활용).

---

## 5. Docs / Notes

### README Updates
- 추가 또는 수정할 섹션: 아키텍처 다이어그램 또는 모듈 설명.
- 전달하고자 하는 핵심 메시지: `common` 모듈이 데이터 모델의 중심임을 명시.

### Example Snippet (Optional)

```python
# src/chatbot_tester/runner/models.py

# 공통 모델을 재내보내기하여 하위 호환성 유지
from chatbot_tester.common.models import (
    Message,
    TestSample,
    RunResultStatus,
)

# Runner 전용 모델은 여기에 유지
@dataclass
class RunConfig:
    ...
```
