# Daily Framework Planning – 2025-W06-day1

> Repository: chatbot-tester
> Type: Library / SDK (Generator · Runner · Evaluator)
> Cadence: Daily (주차 내 일차별 사고 기록)
> Focus: Architecture, API design, extensibility, reproducibility

---

## Language Rule (MANDATORY)

- 본 문서의 **모든 내용은 반드시 한국어로 작성**합니다.
- 다음 항목만 예외적으로 영어 사용을 허용합니다:
  - 코드 블록
  - 파일 경로
  - 함수명 / 클래스명 / 모듈명
  - CLI 커맨드
  - 고유 명사 (예: OpenAI, CLI, SDK, Generator, Runner, Evaluator)
- 번역체가 아닌 **기술 기획 문서에 적합한 자연스러운 한국어**를 사용합니다.

---

## 1. Discovery (Ideas)

> Goal: 재사용 가능한 SDK 관점에서의 프레임워크 수준 개선 아이디어를
> **하루 단위로 축적**한다.

### Idea 1
- Affected layer: Common
- Current limitation: `generator`와 `runner` 모듈에서 `Message`, `TestSample` 데이터 모델이 중복 정의되어 있습니다. `runner` 버전은 `slots=True`와 팩토리 메서드를 포함하여 더 강력하지만 `generator`는 단순한 데이터 클래스입니다.
- Proposed improvement: `chatbot_tester.common.models` 모듈을 신설하여 핵심 데이터 모델을 중앙화하고, 두 모듈이 이를 참조하도록 리팩토링합니다.
- Why this matters for an SDK: 데이터 구조의 불일치는 모듈 간 통합 시 오류를 유발하며, 타입 힌팅과 유효성 검사를 어렵게 만듭니다.

### Idea 2
- Affected layer: Common / Runner
- Current limitation: `ChatBackend` 구현체가 모듈 내부에 파편화되어 있거나, 새로운 백엔드 추가 시 코드 수정이 필요할 수 있습니다.
- Proposed improvement: `chatbot_tester.common.backends` 패키지를 생성하고 백엔드 등록 시스템(Registry)을 공통화하여 플러그인 형태로 확장 가능하게 만듭니다.
- Why this matters for an SDK: 사용자가 코어 로직 수정 없이 새로운 LLM 공급자(예: Anthropic, Bedrock)를 쉽게 연동할 수 있어야 합니다.

### Idea 3
- Affected layer: Common
- Current limitation: 데이터셋, 실행 결과, 리포트 등의 아티팩트 저장이 로컬 파일 시스템 경로에 하드코딩된 경우가 많습니다.
- Proposed improvement: `ArtifactStore` 추상화를 도입하여 로컬 파일 시스템뿐만 아니라 S3, GCS 등으로 저장소를 확장할 수 있도록 인터페이스를 정의합니다.
- Why this matters for an SDK: 클라우드 환경에서의 실행 및 CI/CD 파이프라인 통합을 위해서는 유연한 스토리지 백엔드 지원이 필수적입니다.

### Idea 4
- Affected layer: Evaluator
- Current limitation: 평가 지표(Metric) 설정이 정적이거나 코드에 강하게 결합되어 있어, 실행 시점에 동적으로 평가 기준을 변경하기 어렵습니다.
- Proposed improvement: 평가 파이프라인을 YAML 설정으로 정의할 수 있게 하고, 런타임에 필요한 Metric만 로드하여 실행하는 동적 평가 시스템을 구축합니다.
- Why this matters for an SDK: 다양한 실험 시나리오에 맞춰 평가 기준을 유연하게 조정할 수 있어야 합니다.

### Idea 5
- Affected layer: CLI
- Current limitation: 각 모듈(`generator`, `runner`, `evaluator`)별로 별도의 CLI 진입점이 존재하거나 `python -m` 호출이 필요하여 사용성이 떨어집니다.
- Proposed improvement: 통합 CLI 명령어 `ct` (또는 `chatbot-tester`)를 도입하고, 서브커맨드(`gen`, `run`, `eval`) 구조로 통일하여 사용자 경험을 개선합니다.
- Why this matters for an SDK: 단일 진입점을 제공함으로써 사용법을 표준화하고, 로깅이나 설정 같은 공통 기능을 일관되게 적용할 수 있습니다.

---

## 2. Triage

> Goal: **오늘 기준** 가장 아키텍처적 파급력이 큰 1개 아이디어를 선정한다.

### Selected Idea
- Title: 공통 데이터 모델 통합 (Common Data Models Integration)
- Primary affected layer(s): Common, Generator, Runner

### Selection Rationale
- Architectural leverage: 데이터 모델은 프레임워크의 가장 기본이 되는 단위입니다. 이를 통일하는 것은 이후의 파이프라인 통합이나 공통 기능 개발의 선결 조건입니다.
- Impact on extensibility / reuse: 단일화된 모델 정의를 통해 모듈 간 데이터 교환이 안전해지고, 새로운 기능 추가 시 모델 변경이 한곳에서 이루어질 수 있습니다.
- Reduction of future complexity: 중복 코드를 제거함으로써 유지보수 부담을 줄이고, `generator`와 `runner` 간의 미묘한 구현 차이로 인한 버그를 예방합니다.

### Deferred Ideas (Brief)
- Idea 2 (Backend Registry): 데이터 모델 통합 후, 실행 로직을 정리할 때 다루는 것이 자연스럽습니다.
- Idea 5 (Unified CLI): 기능이 안정화된 후 사용자 인터페이스를 정리하는 단계에서 진행합니다.

---

## 3. Spec Draft (Top 1 Only)

### Feature / Improvement Name
공통 데이터 모델 통합 (Common Data Models Integration)

### Problem Statement
- 현재 `generator/types.py`와 `runner/models.py`에 `Message`, `TestSample` 클래스가 중복 정의되어 있습니다.
- `runner`의 구현체는 `slots=True`를 사용하고 `from_dict`, `to_dict` 메서드가 잘 구현되어 있는 반면, `generator`는 기능이 부족합니다.
- 이로 인해 모듈 간 데이터 전달 시 호환성 문제가 발생할 수 있으며, 코드 수정 시 두 곳을 모두 고쳐야 하는 번거로움이 있습니다.
- 라이브러리 유지보수자와 내부 구조를 확장하려는 고급 사용자에게 혼란을 줍니다.

### Design Approach (High-level)
- Core concept: 중복된 모델 정의를 `chatbot_tester.common` 패키지로 이동하여 단일 소스(Single Source of Truth)로 관리합니다.
- Key abstractions or interfaces:
  - `src/chatbot_tester/common/models.py`: `Message`, `TestSample` 및 관련 헬퍼 함수 정의.
- Expected behavior:
  - `generator`와 `runner`는 더 이상 자체 모델을 정의하지 않고 `common.models`에서 임포트하여 사용합니다.
  - 기존 데이터 직렬화/역직렬화 로직은 `common` 패키지의 메서드를 사용하도록 통일됩니다.

### MVP Scope
- Included in MVP:
  - `src/chatbot_tester/common/models.py` 생성.
  - `runner/models.py`의 `Message`, `TestSample` 클래스(메서드 포함)를 `common`으로 이동.
  - `generator/types.py` 및 `runner/models.py`에서 `common` 모델을 임포트하도록 수정.
  - 관련 의존성(`pydantic` 등 사용 시) 및 임포트 경로 정리.
- Explicitly excluded:
  - `RunResult` 등 `runner`에 특화된 모델의 이동 (추후 필요 시 검토).
  - 대대적인 로직 리팩토링 (단순 모델 교체에 집중).

### Optional / Future Extensions
- `pydantic.BaseModel`로의 완전한 전환 (현재는 `dataclass` 사용 중).
- 모델 유효성 검사 로직 강화.

### Acceptance Criteria
- [ ] `src/chatbot_tester/common/models.py` 파일이 존재하고 핵심 모델이 정의됨.
- [ ] `generator`와 `runner` 모듈이 `common`의 모델을 정상적으로 임포트하여 사용함.
- [ ] 기존 테스트가 수정 없이(또는 최소한의 수정으로) 통과함.
- [ ] `Message` 및 `TestSample`의 직렬화/역직렬화가 두 모듈에서 일관되게 동작함.

---

## 4. Backlog Draft (Issue-Level)

### Suggested GitHub Issue Title
`[Framework][Daily][2025-W06-day1] Centralize Message and TestSample models to Common package`

### Task Breakdown
- [ ] Core implementation
  - Module: `chatbot_tester.common`
  - Summary: `common` 패키지 생성 및 `models.py` 작성. `runner`의 고도화된 모델 구현을 이곳으로 이동.
- [ ] Refactoring
  - Module: `chatbot_tester.generator`, `chatbot_tester.runner`
  - Summary: 기존 모델 정의 삭제 및 `common` 패키지 임포트로 대체. 타입 힌트 수정.
- [ ] API impact
  - Breaking change: No (내부 구현 변경, `generator.types`나 `runner.models`에서 re-export하면 하위 호환성 유지 가능).
  - Migration needed: No (라이브러리 내부 변경).
- [ ] Tests
  - Unit / Integration: 모델 이동 후 기존 유닛 테스트 수행 및 통과 확인. `common.models`에 대한 기본 테스트 추가.
- [ ] Documentation
  - Docstrings: 이동된 모델에 대한 명확한 Docstring 작성.

### Notes
- Backward compatibility concerns: `generator.types`와 `runner.models`가 공개 API로 사용되고 있다면, 해당 모듈에서 `common.models`의 클래스를 import하여 다시 노출(re-export)해야 합니다.
- Refactoring risk: 순환 참조(Circular Import)가 발생하지 않도록 주의해야 합니다.

---

## 5. Docs / Notes

### README Updates
- 추가 또는 수정할 섹션: 없음 (내부 구조 개선이므로 README 업데이트 불필요).
- 전달하고자 하는 핵심 메시지: N/A

### Example Snippet (Optional)

```python
# Before
from chatbot_tester.runner.models import Message

# After (Recommended internal usage)
from chatbot_tester.common.models import Message
```
