# Daily Framework Planning – 2025-W06-day1

> Repository: chatbot-tester
> Type: Library / SDK (Generator · Runner · Evaluator)
> Cadence: Daily (주차 내 일차별 사고 기록)
> Focus: Architecture, API design, extensibility, reproducibility

---

## Language Rule (MANDATORY)

- 본 문서의 **모든 내용은 반드시 한국어로 작성**합니다.
- 다음 항목만 예외적으로 영어 사용을 허용합니다:
  - 코드 블록
  - 파일 경로
  - 함수명 / 클래스명 / 모듈명
  - CLI 커맨드
  - 고유 명사 (예: OpenAI, CLI, SDK, Generator, Runner, Evaluator)
- 번역체가 아닌 **기술 기획 문서에 적합한 자연스러운 한국어**를 사용합니다.

---

## 1. Discovery (Ideas)

> Goal: 재사용 가능한 SDK 관점에서의 프레임워크 수준 개선 아이디어를
> **하루 단위로 축적**한다.

### Idea 1
- Affected layer: Common / Generator / Runner
- Current limitation: `generator` 모듈과 `runner` 모듈이 각각 `Message`, `TestSample` 클래스를 별도로 정의하고 있습니다. 특히 `generator`는 단순 데이터클래스를 사용하고, `runner`는 `slots=True`와 직렬화 메서드를 갖춘 더 견고한 구현을 사용하고 있어 불일치가 발생합니다.
- Proposed improvement: `src/chatbot_tester/common` 패키지를 신설하고, 중복된 모델 정의를 통합하여 단일 소스(Single Source of Truth)로 관리합니다.
- Why this matters for an SDK: 모듈 간 데이터를 주고받을 때 타입 호환성을 보장하고, 유지보수 시 한 곳만 수정하면 되도록 복잡도를 낮춥니다.

### Idea 2
- Affected layer: Common / CLI
- Current limitation: `gen-dataset`, `runner`, `evaluator` 등 기능별로 진입점이 분산되어 있어 사용자 경험이 파편화되어 있습니다.
- Proposed improvement: 통합 CLI `ct` (또는 `chatbot-tester`)를 도입하여 서브커맨드 방식으로 모든 기능을 실행할 수 있게 합니다.
- Why this matters for an SDK: 사용자가 단일 명령어로 전체 워크플로우를 제어할 수 있어 학습 곡선을 낮추고 사용성을 개선합니다.

### Idea 3
- Affected layer: Common / Backend
- Current limitation: LLM 호출을 담당하는 `ChatBackend` 로직이 모듈별로 산재해 있거나 특정 모듈에 종속적일 수 있습니다.
- Proposed improvement: 백엔드 레지스트리와 구현체를 `common` 영역으로 이동하여 Generator의 데이터 증강 기능 등에서도 재사용할 수 있게 합니다.
- Why this matters for an SDK: 코드 재사용성을 높이고, 새로운 백엔드 추가 시 모든 모듈에서 즉시 활용할 수 있게 합니다.

---

## 2. Triage

> Goal: **오늘 기준** 가장 아키텍처적 파급력이 큰 1개 아이디어를 선정한다.

### Selected Idea
- Title: 도메인 모델 통합 (Consolidation of Domain Models)
- Primary affected layer(s): Common

### Selection Rationale
- Architectural leverage: 프레임워크의 근간이 되는 데이터 구조를 통일함으로써, 향후 진행될 통합 오케스트레이터나 CLI 작업의 안정적인 기반이 됩니다.
- Impact on extensibility / reuse: 외부 플러그인이나 확장 기능을 만들 때 참조할 명확한 공통 타입 정의를 제공합니다.
- Reduction of future complexity: 코드 중복으로 인한 잠재적 버그(필드 불일치 등)를 사전에 제거합니다.

### Deferred Ideas (Brief)
- Idea 2 (CLI): 모델 통합이 선행되어야 CLI 내부에서 데이터 객체를 일관되게 다룰 수 있으므로 연기합니다.
- Idea 3 (Backend): 모델 리팩토링 후 순차적으로 진행하는 것이 자연스럽습니다.

---

## 3. Spec Draft (Top 1 Only)

### Feature / Improvement Name
도메인 모델 공통 패키지 분리 (Common Domain Models Refactoring)

### Problem Statement
- 현재 `generator/types.py`와 `runner/models.py`에 `Message`, `TestSample` 등의 핵심 클래스가 중복 정의되어 있습니다.
- `generator`의 출력 데이터를 `runner`가 입력으로 받을 때, 서로 다른 클래스 정의로 인해 불필요한 변환 과정이나 타입 오류가 발생할 수 있습니다.
- 이는 프레임워크 유지보수자에게 중복 수정 부담을 주며, SDK 사용자에게는 혼란을 줍니다.

### Design Approach (High-level)
- Core concept: 핵심 데이터 모델을 `chatbot_tester.common.models`로 이동하여 중앙화합니다.
- Key abstractions or interfaces:
  - `Message`: 대화 메시지 모델.
  - `TestSample`: 테스트 케이스 모델.
  - `RunResultStatus`: 실행 상태 Enum.
- Expected behavior:
  - `generator`와 `runner` 모듈은 더 이상 자체적으로 모델을 정의하지 않고 `common` 패키지에서 임포트하여 사용합니다.
  - 기존 코드의 동작은 동일하게 유지됩니다 (Refactoring).

### MVP Scope
- Included in MVP:
  - `src/chatbot_tester/common/models.py` 파일 생성.
  - `runner/models.py`의 고도화된 모델(`slots`, `to_dict` 포함)을 `common`으로 이동.
  - `generator`와 `runner`의 임포트 경로 수정.
- Explicitly excluded:
  - 아직 널리 사용되지 않거나 실험적인 모델의 이동.
  - 데이터베이스 스키마 등 영속성 계층의 변경.

### Optional / Future Extensions
- Pydantic 모델로의 완전한 전환 (현재는 dataclass 사용 중).
- 모델 유효성 검사 로직 추가.

### Acceptance Criteria
- [ ] `chatbot_tester.common` 패키지가 정상적으로 생성되고 모듈로 인식됨.
- [ ] `generator`와 `runner`가 공통 모델을 참조하며, 기존 단위 테스트가 모두 통과함.
- [ ] 순환 참조(Circular dependency) 문제가 발생하지 않음.

---

## 4. Backlog Draft (Issue-Level)

### Suggested GitHub Issue Title
`[Refactor] Consolidate Message and TestSample models into common package`

### Task Breakdown
- [ ] Core implementation
  - Module: `src/chatbot_tester/common/models.py`
  - Summary: `runner` 모듈의 `Message`, `TestSample`, `RunResultStatus` 등을 `common`으로 이동하고 `__all__` 정의.
- [ ] CLI changes (if any)
  - Command: N/A
  - Flags / options: N/A
- [ ] API impact
  - Breaking change: No (내부 리팩토링)
  - Migration needed: Yes (SDK 사용자가 직접 내부 모듈을 임포트해서 썼다면 경로 수정 필요)
- [ ] Tests
  - Unit / Integration: 기존 테스트 실행으로 회귀 테스트 수행.
- [ ] Documentation
  - README / Examples / Docstrings: 변경된 모듈 경로 반영 (필요 시).

### Notes
- Backward compatibility concerns: `runner.models`에서 `common.models`의 내용을 다시 임포트(Re-export)해주면 하위 호환성을 유지할 수 있음.
- Refactoring risk: 순환 참조 주의.

---

## 5. Docs / Notes

### README Updates
- 추가 또는 수정할 섹션: 개발자 가이드 (Developer Guide)
- 전달하고자 하는 핵심 메시지: "핵심 데이터 모델은 `chatbot_tester.common`에 정의되어 있으니, 새로운 모듈 개발 시 이를 참조하세요."

### Example Snippet (Optional)

```python
# Before
from chatbot_tester.runner.models import Message

# After
from chatbot_tester.common.models import Message
```
