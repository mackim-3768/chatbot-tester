# Daily Framework Planning – 2025-W06-day1

> Repository: chatbot-tester
> Type: Library / SDK (Generator · Runner · Evaluator)
> Cadence: Daily (주차 내 일차별 사고 기록)
> Focus: Architecture, API design, extensibility, reproducibility

---

## Language Rule (MANDATORY)

- 본 문서의 **모든 내용은 반드시 한국어로 작성**합니다.
- 다음 항목만 예외적으로 영어 사용을 허용합니다:
  - 코드 블록
  - 파일 경로
  - 함수명 / 클래스명 / 모듈명
  - CLI 커맨드
  - 고유 명사 (예: OpenAI, CLI, SDK, Generator, Runner, Evaluator)
- 번역체가 아닌 **기술 기획 문서에 적합한 자연스러운 한국어**를 사용합니다.

---

## 1. Discovery (Ideas)

> Goal: 재사용 가능한 SDK 관점에서의 프레임워크 수준 개선 아이디어를
> **하루 단위로 축적**한다.

### Idea 1
- Affected layer: Common
- Current limitation: `generator/types.py`와 `runner/models.py`에 `Message`, `TestSample` 등의 핵심 데이터 모델이 중복 정의되어 있으며, 구현 방식(예: `slots=True`, `from_dict` 메서드 유무)이 일치하지 않습니다.
- Proposed improvement: `chatbot_tester.common` 패키지를 신설하고 핵심 모델들을 이동시켜 단일 진실 공급원(Single Source of Truth)으로 관리합니다.
- Why this matters for an SDK: 데이터 구조의 불일치는 모듈 간 통합 시 예기치 않은 버그를 유발하며, 유지보수 복잡도를 증가시킵니다.

### Idea 2
- Affected layer: CLI
- Current limitation: Generator, Runner, Evaluator가 각각 개별적인 진입점을 가지고 있거나 명확한 통합 CLI가 부재하여 사용성이 떨어집니다.
- Proposed improvement: `ct` (Chatbot Tester)와 같은 통합 CLI 엔트리포인트를 구축하여 `ct generate`, `ct run`, `ct evaluate`와 같이 일관된 명령어로 워크플로우를 제어하도록 합니다.
- Why this matters for an SDK: 사용자 경험(UX)을 통일하고, 파이프라인 자동화 및 CI/CD 통합을 용이하게 합니다.

### Idea 3
- Affected layer: Configuration
- Current limitation: 실험 설정이 코드 내에 하드코딩되어 있거나 여러 파일에 분산되어 있어, 실험의 재현성을 보장하기 어렵습니다.
- Proposed improvement: `experiment.yaml`과 같은 통합 설정 파일 포맷을 정의하여 데이터 생성, 실행, 평가에 이르는 전 과정을 하나의 파일로 선언적으로 관리합니다.
- Why this matters for an SDK: 실험의 재현성을 확보하고(Reproducibility), 다양한 실험 조건을 손쉽게 관리할 수 있습니다.

### Idea 4
- Affected layer: Evaluator
- Current limitation: 평가 지표(Metric)가 프레임워크 내부에 고정되어 있어, 사용자가 자신만의 평가 로직을 추가하기 어렵습니다.
- Proposed improvement: 플러그인 아키텍처를 도입하여 사용자가 외부에서 정의한 Metric 클래스를 등록하고 사용할 수 있도록 개선합니다.
- Why this matters for an SDK: 다양한 도메인과 요구사항에 대응하기 위한 확장성(Extensibility)을 제공합니다.

### Idea 5
- Affected layer: Common / Storage
- Current limitation: 결과물 저장이 로컬 파일 시스템에 의존적이며, S3나 GCS 같은 클라우드 스토리지 연동이 구조적으로 어렵습니다.
- Proposed improvement: `ArtifactStore` 인터페이스를 추상화하여 저장소 백엔드를 교체할 수 있도록 합니다.
- Why this matters for an SDK: 대규모 실험 데이터 관리 및 클라우드 환경에서의 운영 효율성을 높입니다.

---

## 2. Triage

> Goal: **오늘 기준** 가장 아키텍처적 파급력이 큰 1개 아이디어를 선정한다.

### Selected Idea
- Title: 핵심 모델의 Common 패키지 추출 (Extract Core Models to Common Package)
- Primary affected layer(s): Common, Generator, Runner

### Selection Rationale
- Architectural leverage: 모든 모듈이 의존하는 가장 기초적인 데이터 구조를 정리함으로써, 향후 `experiment.yaml` 도입이나 통합 CLI 구축의 기반을 마련합니다.
- Impact on extensibility / reuse: 모듈 간 순환 참조(Circular Dependency) 문제를 예방하고, 코드 재사용성을 즉각적으로 향상시킵니다.
- Reduction of future complexity: 중복 코드로 인한 관리 포인트 분산을 막아 기술 부채를 조기에 청산합니다.

### Deferred Ideas (Brief)
- Idea 2 (Unified CLI): 모델 구조가 안정화된 이후에 구현하는 것이 효율적입니다.
- Idea 3 (Experiment Profile): 공통 모델이 정의되어야 설정 스키마를 확정할 수 있습니다.
- Idea 4 (Evaluator Plugins): 현재 평가 기능이 동작하고 있으므로 우선순위가 낮습니다.
- Idea 5 (Artifact Store): 로컬 실행 환경 우선 지원으로 인해 연기합니다.

---

## 3. Spec Draft (Top 1 Only)

### Feature / Improvement Name
핵심 데이터 모델의 Common 패키지 추출 및 통합

### Problem Statement
- 현재 어떤 점이 어렵거나, 불명확하거나, 오류를 유발하는가?
  - `Message`와 `TestSample` 클래스가 `generator`와 `runner` 모듈에 각각 정의되어 있어 코드 중복이 발생합니다.
  - `runner`의 구현체는 `slots=True`와 `from_dict`를 포함하여 더 견고하지만, `generator`는 단순 dataclass로 구현되어 있어 기능 차이가 존재합니다.
- 누구에게 영향을 주는가? (라이브러리 사용자 / CLI 사용자 / 프레임워크 유지보수자)
  - 프레임워크 유지보수자: 변경 사항을 양쪽에 동기화해야 하는 부담.
  - 라이브러리 사용자: 모듈 간 객체 호환성 문제 가능성.

### Design Approach (High-level)
- Core concept: `chatbot_tester.common` 패키지를 신설하고, 도메인 핵심 엔티티를 이곳으로 이동시킵니다.
- Key abstractions or interfaces:
  - `src/chatbot_tester/common/models.py` 모듈 생성.
  - `runner.models`에 있는 `Message`, `TestSample`, `DatasetInfo`, `RunResultStatus`를 `common.models`로 이동.
- Expected behavior:
  - `generator`와 `runner`는 자체 정의 대신 `chatbot_tester.common.models`를 임포트하여 사용합니다.
  - 기존 코드의 동작 변경 없이 구조만 개선(Refactoring)합니다.

### MVP Scope
- Included in MVP:
  - `chatbot_tester.common` 패키지 생성 (`__init__.py`, `models.py`).
  - `runner/models.py`에서 `common/models.py`로 핵심 클래스 이동.
  - `generator/types.py` 및 `runner/models.py`에서 `common` 패키지 참조로 변경.
  - 관련 의존성 수정 및 테스트 통과 확인.
- Explicitly excluded:
  - `RunConfig`, `RunResult` 등 Runner에 특화된 모델의 이동 (추후 검토).
  - `experiment.yaml` 스키마 정의.

### Optional / Future Extensions
- `RunResult` 등 실행 결과 모델도 Common으로 이동하여 Evaluator와의 의존성 분리.
- Pydantic 모델로의 전환을 통해 유효성 검사 강화.

### Acceptance Criteria
- [ ] `chatbot_tester.common.models` 모듈이 존재해야 함.
- [ ] `Message`, `TestSample`이 `common` 패키지에 정의되어야 함.
- [ ] `generator`와 `runner` 코드에서 로컬 정의가 제거되고 `common`을 참조해야 함.
- [ ] 기존 유닛 테스트(`pytest`)가 수정 없이(또는 임포트 경로만 수정하여) 통과해야 함.

---

## 4. Backlog Draft (Issue-Level)

### Suggested GitHub Issue Title
`[Framework][Daily][2025-W06-day1] Extract core models to common package`

### Task Breakdown
- [ ] Core implementation
  - Module: `chatbot_tester.common`
  - Summary: `models.py` 생성 및 `Message`, `TestSample`, `DatasetInfo`, `RunResultStatus` 클래스 이동.
- [ ] API impact
  - Breaking change: No (내부 모듈 구조 변경이지만, `generator.types`, `runner.models`에서 re-export 할 경우 호환성 유지 가능. 여기서는 직접 참조 변경을 목표로 함)
  - Migration needed: No (내부 리팩토링)
- [ ] Tests
  - Unit / Integration: 기존 테스트 수행으로 검증.

### Notes
- Backward compatibility concerns: `runner.models`를 외부에서 직접 임포트해서 쓰는 사용자가 있다면 깨질 수 있으므로, `runner.models`에서 `common.models`의 클래스를 임포트하여 다시 노출(Re-export)하는 것이 안전함.
- Refactoring risk: 순환 참조(Circular Import) 발생 주의.

---

## 5. Docs / Notes

### README Updates
- 추가 또는 수정할 섹션: 없음 (내부 구조 변경)
- 전달하고자 하는 핵심 메시지: N/A

### Example Snippet (Optional)

```python
# Before
from chatbot_tester.runner.models import Message

# After (Internal)
from chatbot_tester.common.models import Message

# Backward Compatibility (in runner/models.py)
from chatbot_tester.common.models import Message as Message
```
