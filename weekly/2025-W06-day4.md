# Daily Framework Planning – 2025-W06-day4

> Repository: chatbot-tester
> Type: Library / SDK (Generator · Runner · Evaluator)
> Cadence: Daily (주차 내 일차별 사고 기록)
> Focus: Architecture, API design, extensibility, reproducibility

---

## Language Rule (MANDATORY)

- 본 문서의 **모든 내용은 반드시 한국어로 작성**합니다.
- 다음 항목만 예외적으로 영어 사용을 허용합니다:
  - 코드 블록
  - 파일 경로
  - 함수명 / 클래스명 / 모듈명
  - CLI 커맨드
  - 고유 명사 (예: OpenAI, CLI, SDK, Generator, Runner, Evaluator)
- 번역체가 아닌 **기술 기획 문서에 적합한 자연스러운 한국어**를 사용합니다.

---

## 1. Discovery (Ideas)

> Goal: 재사용 가능한 SDK 관점에서의 프레임워크 수준 개선 아이디어를
> **하루 단위로 축적**한다.

### Idea 1
- Affected layer: CLI / All
- Current limitation: 현재 `src/chatbot_tester/main.py`의 통합 CLI(`ct`)는 `generate` 명령만 부분적으로 구현되어 있으며, `run`과 `evaluate` 명령은 placeholder 상태로 남아 있어 실제 사용이 불가능함.
- Proposed improvement: `main.py` 내 `run` 및 `evaluate` 서브커맨드 핸들러를 구현하여, `TesterConfig`를 통해 로드된 설정을 기반으로 실제 Runner 및 Evaluator 로직을 호출하도록 완성함.
- Why this matters for an SDK: 사용자가 단일 진입점(`ct`)을 통해 전체 파이프라인(생성-실행-평가)을 일관되게 제어할 수 있어야 프레임워크로서의 가치가 있음.

### Idea 2
- Affected layer: Runner
- Current limitation: `src/chatbot_tester/runner/storage.py` 파일에서 `StorageBackend`를 타입 힌트로 사용하고 있으나, 명시적인 임포트 구문이 누락되어 있거나 불분명하여 잠재적인 런타임 오류 가능성이 있음.
- Proposed improvement: `core.storage` 모듈의 의존성을 명확히 하고, Runner 내부의 저장소 로직이 Core의 추상화를 올바르게 따르도록 수정함.
- Why this matters for an SDK: 모듈 간 의존성 관리가 명확해야 유지보수 및 확장이 용이함.

### Idea 3
- Affected layer: Core / Runner / Evaluator
- Current limitation: 각 모듈이 파일 입출력을 개별적으로 처리하거나 `LocalFileSystemStorage`를 직접 사용하는 등 저장소 접근 방식이 파편화될 조짐이 있음.
- Proposed improvement: `ArtifactStore` 개념을 도입하거나 `StorageBackend` 사용을 강제하여, 향후 S3/GCS 등 원격 저장소 지원 시 코드 변경을 최소화함.
- Why this matters for an SDK: 확장성 있는 아키텍처를 위해 I/O 추상화는 필수적임.

### Idea 4
- Affected layer: Generator
- Current limitation: `main.py`에서 Generator를 호출할 때, Config 객체를 그대로 넘기지 않고 개별 인자로 풀어서 전달하고 있어(`unwrap`), 설정 항목이 늘어날 때마다 `main.py` 수정이 필요함.
- Proposed improvement: `generate_structured_synthetic_dataset` 함수가 `GeneratorConfig` 객체를 직접 인자로 받을 수 있도록 리팩토링하거나, 어댑터 레이어를 개선함.
- Why this matters for an SDK: 설정 객체를 통한 파라미터 전달은 API의 안정성을 높이고 변경에 유연하게 대처하게 함.

### Idea 5
- Affected layer: Evaluator
- Current limitation: 평가 리포트 생성 시 차원별 분석(Breakdown)이 하드코딩되어 있거나 유연하지 않을 수 있음.
- Proposed improvement: `EvaluatorConfig` 내 `breakdown` 설정을 동적으로 반영하여 다양한 차원(예: 태그, 언어, 길이 등)으로 결과를 집계할 수 있도록 개선함.
- Why this matters for an SDK: 사용자의 다양한 분석 요구사항을 충족시키기 위해 유연한 리포팅 기능이 중요함.

---

## 2. Triage

> Goal: **오늘 기준** 가장 아키텍처적 파급력이 큰 1개 아이디어를 선정한다.

### Selected Idea
- Title: Unified CLI (`ct`) Implementation
- Primary affected layer(s): CLI (`src/chatbot_tester/main.py`)

### Selection Rationale
- Architectural leverage: CLI는 사용자와 프레임워크가 만나는 접점으로, 이 부분이 완성되어야 전체 워크플로우(End-to-End) 테스트 및 검증이 가능해짐.
- Impact on extensibility / reuse: 단일 진입점이 확립되면 향후 CI/CD 통합이나 자동화 스크립트 작성이 용이해짐.
- Reduction of future complexity: 초기에 CLI 구조를 잘 잡아두지 않으면 각 모듈별로 별도의 실행 스크립트가 난립하게 되어 복잡도가 증가함.

### Deferred Ideas (Brief)
- Runner Storage Fix: 중요하지만 버그 픽스에 가까우므로, 기능 구현 후 백로그로 처리 가능.
- ArtifactStore Abstraction: 현재는 로컬 파일 시스템 위주로 동작해도 무방하므로 우선순위 조정.

---

## 3. Spec Draft (Top 1 Only)

### Feature / Improvement Name
Unified CLI (`ct`) Implementation for Run & Evaluate

### Problem Statement
- 현재 어떤 점이 어렵거나, 불명확하거나, 오류를 유발하는가?
  - `ct run`이나 `ct evaluate` 명령을 실행하면 "Not fully implemented" 메시지만 출력되고 아무 동작도 하지 않음.
  - 사용자는 `src` 내부의 개별 함수를 직접 호출하거나 별도의 스크립트를 작성해야 하는 불편함이 있음.
- 누구에게 영향을 주는가?
  - CLI 사용자: 프레임워크 기능을 CLI로 사용하려는 엔드 유저.

### Design Approach (High-level)
- Core concept: `TesterConfig`를 통해 로드된 설정을 `Runner`와 `Evaluator`의 진입점 함수에 매핑하여 실행함.
- Key abstractions or interfaces:
  - `src/chatbot_tester/main.py`: `argparse` 서브커맨드 핸들러 확장.
  - `src/chatbot_tester/runner/runner_core.py`: `run_job` 호출 연동.
  - `src/chatbot_tester/evaluator`: 평가 로직 진입점 연동 (현재 명확한 엔트리포인트가 없다면 CLI용 래퍼 필요).
- Expected behavior:
  - `ct run --config experiment.yaml` 실행 시 `runner` 설정에 따라 테스트를 수행하고 결과 아티팩트를 저장.
  - `ct evaluate --config experiment.yaml` 실행 시 `evaluator` 설정에 따라 이전 실행 결과를 로드하여 평가 및 리포트 생성.

### MVP Scope
- Included in MVP:
  - `run` 서브커맨드 구현: `RunnerConfig` 및 데이터셋 로드 후 `run_job` 실행.
  - `evaluate` 서브커맨드 구현: 기본 평가 로직 호출.
  - `main.py` 내 예외 처리 및 로깅 초기화 표준화.
- Explicitly excluded:
  - 복잡한 CLI 인자 오버라이딩 (우선 Config 파일 의존).
  - 원격 저장소 연동.

### Optional / Future Extensions
- CLI 인자를 통한 Config 일부 항목(예: `output_dir`) 오버라이딩 기능.
- 진행률 표시줄(Progress Bar) 개선 (현재 로그 기반).

### Acceptance Criteria
- [ ] `ct run --config ...` 명령이 정상적으로 Runner를 구동하고 결과를 출력해야 함.
- [ ] `ct evaluate --config ...` 명령이 정상적으로 Evaluator를 구동하고 리포트를 생성해야 함.
- [ ] Config 파일에 해당 섹션이 누락된 경우 적절한 에러 메시지를 출력하고 종료해야 함.

---

## 4. Backlog Draft (Issue-Level)

### Suggested GitHub Issue Title
`[Framework][CLI] Implement 'run' and 'evaluate' subcommands in Unified CLI`

### Task Breakdown
- [ ] Core implementation
  - Module: `src/chatbot_tester/main.py`
  - Summary: `run` 및 `evaluate` 서브커맨드 분기 내에 실제 로직 호출 코드 구현. `RunnerConfig` 및 `EvaluatorConfig` 활용.
- [ ] CLI changes (if any)
  - Command: `ct run`, `ct evaluate`
  - Flags / options: 기존 `--config` 활용.
- [ ] API impact
  - Breaking change: No
  - Migration needed: No
- [ ] Tests
  - Unit / Integration: `smoke_test.py` 또는 새로운 CLI 통합 테스트 스크립트를 통해 `ct` 커맨드 동작 검증.
- [ ] Documentation
  - README / Examples / Docstrings: README에 CLI 사용 예시 추가 (`ct run`, `ct evaluate`).

### Notes
- Backward compatibility concerns: 기존에 부분적으로 작동하던 `generate` 커맨드는 영향받지 않아야 함.
- Refactoring risk: `main.py`가 너무 비대해지지 않도록 로직을 각 모듈의 `cli.py` 등으로 위임하는 방안 고려 필요(MVP 이후).

---

## 5. Docs / Notes

### README Updates
- 추가 또는 수정할 섹션: "Usage - CLI" 섹션
- 전달하고자 하는 핵심 메시지: 이제 하나의 설정 파일(`experiment.yaml`)과 하나의 커맨드(`ct`)로 전체 테스트 수명주기를 관리할 수 있음.

### Example Snippet (Optional)

```bash
# 1. 데이터셋 생성
ct generate --config experiment.yaml

# 2. 테스트 실행 (LLM 호출)
ct run --config experiment.yaml

# 3. 결과 평가 및 리포트 생성
ct evaluate --config experiment.yaml
```
