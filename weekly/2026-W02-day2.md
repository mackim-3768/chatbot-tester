# Daily Framework Planning – 2026-W02-day2

> Repository: chatbot-tester
> Type: Library / SDK (Generator · Runner · Evaluator)
> Cadence: Daily (주차 내 일차별 사고 기록)
> Focus: Architecture, API design, extensibility, reproducibility

---

## Language Rule (MANDATORY)

- 본 문서의 **모든 내용은 반드시 한국어로 작성**합니다.
- 다음 항목만 예외적으로 영어 사용을 허용합니다:
  - 코드 블록
  - 파일 경로
  - 함수명 / 클래스명 / 모듈명
  - CLI 커맨드
  - 고유 명사 (예: OpenAI, CLI, SDK, Generator, Runner, Evaluator)
- 번역체가 아닌 **기술 기획 문서에 적합한 자연스러운 한국어**를 사용합니다.

---

## 1. Discovery (Ideas)

> Goal: 재사용 가능한 SDK 관점에서의 프레임워크 수준 개선 아이디어를
> **하루 단위로 축적**한다.

### Idea 1
- Affected layer: Common
- Current limitation: `Message`와 `TestSample` 같은 핵심 데이터 모델이 `generator`와 `runner` 모듈에 각각 중복 정의되어 있습니다.
- Proposed improvement: `chatbot_tester.common` 패키지를 신설하여 공통 모델을 이곳으로 통합하고, 각 모듈이 이를 참조하도록 리팩토링합니다.
- Why this matters for an SDK: 데이터 교환 시 타입 호환성을 보장하고, 중복 코드 관리로 인한 유지보수 비용을 절감하며, 향후 확장 시 일관성을 유지할 수 있습니다.

### Idea 2
- Affected layer: Runner
- Current limitation: Runner 백엔드 확장이 `backends` 디렉토리에 코드를 추가하는 방식으로 제한적이며, Evaluator와 달리 플러그인 구조가 아닙니다.
- Proposed improvement: Runner 백엔드 시스템을 플러그인 기반 아키텍처로 전환하여 외부 패키지에서도 백엔드를 정의하고 주입할 수 있도록 개선합니다.
- Why this matters for an SDK: 사용자가 코어 코드를 수정하지 않고도 자체적인 LLM 백엔드나 모의 객체(Mock)를 쉽게 추가할 수 있어 확장성이 대폭 향상됩니다.

### Idea 3
- Affected layer: CLI
- Current limitation: `generator`, `runner`, `evaluator`가 각각 별도의 CLI 엔트리포인트를 가지고 있어 사용자 경험이 파편화되어 있습니다.
- Proposed improvement: `ct` (가칭)라는 통합 CLI 엔트리포인트를 도입하여 하위 명령어로 각 기능을 호출할 수 있도록 표준화합니다.
- Why this matters for an SDK: 단일 진입점을 제공함으로써 학습 곡선을 낮추고, 파이프라인 전체를 아우르는 통합적인 사용 경험을 제공할 수 있습니다.

### Idea 4
- Affected layer: Common (Configuration)
- Current limitation: 실험 설정이 생성, 실행, 평가 단계별로 분산되어 있어, 하나의 실험을 재현하거나 관리하기 어렵습니다.
- Proposed improvement: `experiment.yaml`과 같은 통합 실험 프로필 포맷을 정의하여 데이터셋 생성부터 실행, 평가까지의 전 과정을 하나의 설정 파일로 제어하도록 합니다.
- Why this matters for an SDK: 실험의 재현성(Reproducibility)을 보장하고, 복잡한 파이프라인 구성을 선언적으로 관리할 수 있게 됩니다.

### Idea 5
- Affected layer: Runner / Evaluator
- Current limitation: 실행 결과나 평가 리포트 등의 아티팩트 저장이 로컬 파일 시스템에 강결합되어 있습니다.
- Proposed improvement: `ArtifactStore` 추상화를 도입하여 로컬 파일뿐만 아니라 S3, GCS 등 원격 스토리지도 지원할 수 있도록 유연성을 확보합니다.
- Why this matters for an SDK: 클라우드 환경이나 CI/CD 파이프라인에서의 사용성을 높이고, 대규모 실험 데이터 관리를 용이하게 합니다.

---

## 2. Triage

> Goal: **오늘 기준** 가장 아키텍처적 파급력이 큰 1개 아이디어를 선정한다.

### Selected Idea
- Title: `chatbot_tester.common` 패키지 신설 및 핵심 모델(`Message`, `TestSample`) 통합
- Primary affected layer(s): Generator, Runner, Evaluator (Common)

### Selection Rationale
- Architectural leverage: 모든 모듈이 의존하는 최하위 데이터 구조를 통일함으로써, 향후 기능 확장(예: 통합 CLI, `experiment.yaml`)의 기반을 마련합니다.
- Impact on extensibility / reuse: 모듈 간 데이터 전달 시 변환 비용을 없애고, 외부에서 SDK로 사용할 때 명확한 타입 정의를 제공할 수 있습니다.
- Reduction of future complexity: 중복된 클래스 정의를 제거하여 버그 발생 가능성을 낮추고, 한 곳의 수정이 시스템 전체에 일관되게 반영되도록 합니다.

### Deferred Ideas (Brief)
- Unified CLI: 핵심 모델 통합이 선행되어야 각 서브 명령어가 일관된 객체를 다룰 수 있으므로 연기합니다.
- Plugin-based Runner: 현재 구조에서도 확장은 가능하므로, 코드 베이스 안정화 이후로 미룹니다.

---

## 3. Spec Draft (Top 1 Only)

### Feature / Improvement Name
`chatbot_tester.common` 패키지 도입 및 `Message`, `TestSample` 모델 통합

### Problem Statement
- 현재 `generator`와 `runner` 패키지에 `Message`와 `TestSample` 클래스가 각각 정의되어 있습니다.
- `runner`의 구현은 `slots=True`와 `from_dict` 메서드를 포함하여 더 견고한 반면, `generator`의 구현은 상대적으로 단순합니다.
- 이러한 중복과 불일치는 모듈 간 연동 시 데이터 변환 로직을 필요로 하며, 유지보수의 어려움을 초래합니다.
- 라이브러리 사용자 입장에서는 어떤 패키지의 모델을 import 해야 할지 혼란스러울 수 있습니다.

### Design Approach (High-level)
- Core concept: `src/chatbot_tester/common` 패키지를 신설하여 시스템 전반에서 공유되는 핵심 데이터 모델과 유틸리티를 배치합니다.
- Key abstractions or interfaces:
  - `src/chatbot_tester/common/models.py`: `runner`의 구현(`slots=True`, `to_dict`, `from_dict`)을 베이스로 하여 `Message`, `TestSample`을 정의합니다.
  - `generator`와 `runner`는 자체 정의를 삭제하고 `common.models`를 import 하여 사용합니다.
- Expected behavior: 기존 코드는 import 경로 변경 외에는 논리적 동작 변화 없이 그대로 작동해야 합니다.

### MVP Scope
- Included in MVP:
  - `src/chatbot_tester/common` 패키지 생성 (`__init__.py` 포함).
  - `runner/models.py`의 내용을 기반으로 `common/models.py` 작성.
  - `generator/types.py`에서 중복 정의 제거 및 `common` 참조로 변경.
  - `runner/models.py`에서 중복 정의 제거 및 `common` 참조로 변경.
  - 관련 모듈의 import 문 수정.
- Explicitly excluded:
  - `Message`, `TestSample` 외의 다른 모델(예: `RunResult` 등)의 이동 (이번 단계에서는 핵심 모델에 집중).
  - `ChatBackend` 등 다른 공통 컴포넌트 이동.

### Optional / Future Extensions
- `ChatBackend` 레지스트리를 `common`으로 이동하여 Generator와 Runner가 백엔드 로직을 공유하도록 개선.
- `RunResult`, `DatasetInfo` 등 Runner 전용으로 보이는 모델들도 범용성이 있다면 점진적으로 `common`으로 이동 검토.

### Acceptance Criteria
- [ ] `src/chatbot_tester/common/models.py` 파일이 생성되고 `Message`, `TestSample`이 정의되어야 함.
- [ ] `generator`와 `runner` 패키지 내 중복된 클래스 정의가 제거되어야 함.
- [ ] 기존 유닛 테스트가 수정된 import 경로를 반영하여 통과해야 함.
- [ ] `generator`로 생성한 데이터를 `runner`가 별도 변환 없이 처리할 수 있어야 함.

---

## 4. Backlog Draft (Issue-Level)

### Suggested GitHub Issue Title
`[Framework][Daily][2026-W02-day2] 공통 모델 패키지(common) 신설 및 중복 제거`

### Task Breakdown
- [ ] Core implementation
  - Module: `chatbot_tester.common`
  - Summary: `common` 패키지 생성 및 `runner`의 모델 구현을 `common/models.py`로 이동.
- [ ] Refactoring
  - Module: `chatbot_tester.generator`
  - Summary: `types.py`의 `Message`, `TestSample` 제거 및 `common.models` import 사용으로 변경.
  - Module: `chatbot_tester.runner`
  - Summary: `models.py`의 `Message`, `TestSample` 제거 및 `common.models` import 사용으로 변경.
- [ ] API impact
  - Breaking change: Yes (내부 모듈 구조 변경 및 import 경로 변경)
  - Migration needed: Yes (SDK 사용자라면 import 경로 수정 필요)
- [ ] Tests
  - Unit / Integration: 기존 테스트(`tests/`)가 리팩토링 후에도 정상 동작하는지 확인 및 필요 시 import 구문 수정.
- [ ] Documentation
  - README / Examples / Docstrings: 변경된 모델 위치에 맞춰 예제 코드 및 문서 업데이트.

### Notes
- Backward compatibility concerns: `generator.types`나 `runner.models`에서 직접 클래스를 import 하던 외부 코드는 깨질 수 있습니다. 하위 호환성을 위해 기존 위치에서 `common`의 클래스를 다시 export(`from ..common.models import Message`) 해주는 방식을 고려할 수 있으나, 명확한 구조 개선을 위해 이번에는 과감히 분리하는 것을 권장합니다.
- Refactoring risk: 순환 참조(Circular Dependency)가 발생하지 않도록 주의해야 합니다. `common`은 다른 모듈을 import 하지 않도록 설계해야 합니다.

---

## 5. Docs / Notes

### README Updates
- 추가 또는 수정할 섹션: "Project Structure" 또는 "Developer Guide"
- 전달하고자 하는 핵심 메시지: `Message`, `TestSample` 등 핵심 모델은 이제 `chatbot_tester.common`에 위치하므로, 개발 시 이곳을 참조해야 합니다.

### Example Snippet (Optional)

```python
# Before
from chatbot_tester.generator.types import Message
from chatbot_tester.runner.models import TestSample

# After
from chatbot_tester.common.models import Message, TestSample

msg = Message(role="user", content="Hello")
sample = TestSample(id="test-1", messages=[msg])
```
