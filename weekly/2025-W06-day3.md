# Daily Framework Planning – 2025-W06-day3

> Repository: chatbot-tester
> Type: Library / SDK (Generator · Runner · Evaluator)
> Cadence: Daily (주차 내 일차별 사고 기록)
> Focus: Architecture, API design, extensibility, reproducibility

---

## Language Rule (MANDATORY)

- 본 문서의 **모든 내용은 반드시 한국어로 작성**합니다.
- 다음 항목만 예외적으로 영어 사용을 허용합니다:
  - 코드 블록
  - 파일 경로
  - 함수명 / 클래스명 / 모듈명
  - CLI 커맨드
  - 고유 명사 (예: OpenAI, CLI, SDK, Generator, Runner, Evaluator)
- 번역체가 아닌 **기술 기획 문서에 적합한 자연스러운 한국어**를 사용합니다.

---

## 1. Discovery (Ideas)

> Goal: 재사용 가능한 SDK 관점에서의 프레임워크 수준 개선 아이디어를
> **하루 단위로 축적**한다.

### Idea 1
- Affected layer: Common / CLI
- Current limitation: `chatbot_tester` 패키지 내 `generator`, `runner`, `evaluator`가 각각 별도의 CLI 진입점이나 스크립트 실행 방식을 요구하여 사용자 경험이 파편화되어 있음.
- Proposed improvement: 단일 진입점 `ct` (또는 `chatbot-tester`) 명령어를 제공하고 서브커맨드(`gen`, `run`, `eval`)로 기능을 분기하는 Unified CLI 구현.
- Why this matters for an SDK: 사용자가 도구를 "하나의 제품"으로 인지하게 하며, 향후 파이프라인 자동화나 복합 명령을 수행하기 위한 기반이 됨.

### Idea 2
- Affected layer: Runner
- Current limitation: 현재 `Runner`는 전체 응답을 받은 후 처리하는 방식(`await`)만 지원하여, 챗봇의 스트리밍(Token streaming) 동작이나 첫 토큰 지연 시간(TTFT) 등을 측정하기 어려움.
- Proposed improvement: `Backend` 인터페이스에 비동기 제너레이터(`AsyncIterator`)를 반환하는 `stream()` 메서드를 추가하고, `Runner`가 이를 소비하며 메트릭을 수집하도록 개선.
- Why this matters for an SDK: 실제 챗봇 UX 검증에는 스트리밍 성능 측정이 필수적임.

### Idea 3
- Affected layer: Evaluator
- Current limitation: 단일 메트릭(예: `ExactMatch`, `LLMJudge`) 점수만 산출되며, 여러 메트릭을 가중 합산하거나 조건부로 결합하는 "종합 점수(Composite Score)" 기능이 부재함.
- Proposed improvement: `EvaluatorConfig` 내에 메트릭 간의 수식을 정의할 수 있는 `CompositeMetric` 타입을 도입.
- Why this matters for an SDK: 사용자는 개별 지표보다 "품질 점수" 같은 고차원적인 요약 지표를 원할 때가 많음.

### Idea 4
- Affected layer: Generator
- Current limitation: 데이터 증강 로직(예: `ParaphraseAugmenter`)이 코드 레벨에서 하드코딩되거나 제한적으로만 사용 가능하여, 사용자가 커스텀 증강 로직을 주입하기 어려움.
- Proposed improvement: `Augmenter` 추상 기본 클래스를 정의하고, 구성 파일에서 클래스 경로(dotted path)로 로드할 수 있는 레지스트리 시스템 구축.
- Why this matters for an SDK: 다양한 도메인 특화 증강 기법을 사용자가 직접 구현하여 적용할 수 있어야 함.

### Idea 5
- Affected layer: Common
- Current limitation: 로컬 파일 시스템 경로(`pathlib.Path`)에 강하게 의존하고 있어, S3나 GCS 같은 클라우드 스토리지에 직접 데이터셋을 저장하거나 불러오기 어려움.
- Proposed improvement: `fsspec` 등을 활용하거나 자체 `ArtifactStore` 추상화를 도입하여 경로 처리를 프로토콜(protocol) 기반으로 변경.
- Why this matters for an SDK: 대규모 데이터셋 관리 및 CI/CD 환경에서의 연동을 위해 클라우드 스토리지 지원이 필요함.

---

## 2. Triage

> Goal: **오늘 기준** 가장 아키텍처적 파급력이 큰 1개 아이디어를 선정한다.

### Selected Idea
- Title: Unified CLI Entrypoint (`ct`)
- Primary affected layer(s): Common / CLI

### Selection Rationale
- Architectural leverage: 개별 모듈로 흩어진 기능을 하나의 인터페이스로 통합하여, 향후 "통합 파이프라인"이나 "공통 설정"을 적용할 때 사용자 접점을 일원화할 수 있음.
- Impact on extensibility / reuse: CLI 구조가 잡히면 플러그인 명령어나 유틸리티 명령을 추가하기 용이해짐.
- Reduction of future complexity: 문서화 및 사용 가이드 작성이 `ct` 명령어 하나로 수렴되어 유지보수 부담이 줄어듦.

### Deferred Ideas (Brief)
- Idea 2 (Streaming): 중요하지만 현재 `Runner`의 기본 실행 안정화가 먼저 필요함.
- Idea 5 (Artifact Store): 로컬 실행 환경 우선 최적화 후 도입해도 늦지 않음.

---

## 3. Spec Draft (Top 1 Only)

### Feature / Improvement Name
Unified CLI Entrypoint (`ct`)

### Problem Statement
- 현재 어떤 점이 어렵거나, 불명확하거나, 오류를 유발하는가?
  - 사용자는 `python -m chatbot_tester.generator.cli`, `python -m chatbot_tester.runner.cli` 등 긴 모듈 경로를 기억해야 함.
  - 각 모듈별로 인자 파싱 방식이나 로그 설정 방식이 미묘하게 다를 수 있음.
- 누구에게 영향을 주는가? (라이브러리 사용자 / CLI 사용자 / 프레임워크 유지보수자)
  - CLI 사용자 (생산성 저하), 프레임워크 유지보수자 (진입점 중복 관리).

### Design Approach (High-level)
- Core concept: 최상위 `chatbot_tester.cli` 모듈이 메인 진입점이 되며, `argparse`의 서브커맨드 기능을 사용하여 하위 모듈(`generator`, `runner`, `evaluator`)의 CLI 로직을 호출함.
- Key abstractions or interfaces:
  - `ct` (커맨드 이름): `pyproject.toml`의 `[project.scripts]`에 등록.
  - Dispatcher 패턴: 메인 파서가 서브커맨드를 인식하고, 해당 모듈의 `main` 또는 `register_arguments` 함수로 위임.
- Expected behavior:
  ```bash
  $ ct gen --input data.csv ...
  $ ct run --backend openai ...
  $ ct eval --run-id ...
  ```

### MVP Scope
- Included in MVP:
  - `src/chatbot_tester/cli.py` 생성.
  - `ct` 명령어 등록.
  - `gen`, `run`, `eval` 서브커맨드 구현 (기존 CLI 로직 래핑 또는 호출).
  - 공통 로깅 설정 (`-v`, `--verbose`).
- Explicitly excluded:
  - 통합 파이프라인 실행 (`ct pipeline` 또는 `ct all`) - 이는 추후 `orchestrator` 구현 시 추가.
  - 대화형(Interactive) 모드 / TUI.

### Optional / Future Extensions
- `ct config` 명령어로 기본 설정 관리.
- 플러그인 서브커맨드 자동 탐색.

### Acceptance Criteria
- [ ] `pip install .` 후 `ct` 또는 `chatbot-tester` 명령어가 쉘에서 실행되어야 함.
- [ ] `ct --help` 실행 시 서브커맨드 목록(`gen`, `run`, `eval`)이 표시되어야 함.
- [ ] 각 서브커맨드가 기존 개별 모듈 실행과 동일하게 동작해야 함.
- [ ] `-v` 옵션으로 전체 모듈의 로그 레벨을 제어할 수 있어야 함.

---

## 4. Backlog Draft (Issue-Level)

### Suggested GitHub Issue Title
`[Framework][Daily][2025-W06-day3] Implement Unified CLI Entrypoint`

### Task Breakdown
- [ ] Core implementation
  - Module: `src/chatbot_tester/cli.py`
  - Summary: `argparse`를 사용하여 메인 진입점 구성. 각 하위 모듈의 CLI 함수를 임포트하여 연결.
- [ ] CLI changes (if any)
  - Command: `ct` (신규 등록)
  - Flags / options: `--verbose`, `--version` (전역 옵션).
- [ ] API impact
  - Breaking change: No (기존 `python -m ...` 방식도 당분간 유지 가능하나, 점진적으로 `ct` 사용 권장).
  - Migration needed: No.
- [ ] Tests
  - Unit / Integration: `subprocess` 등을 사용하여 `ct` 명령어 실행 테스트. 각 서브커맨드 호출 여부 검증.
- [ ] Documentation
  - README / Examples / Docstrings: "Installation" 및 "Usage" 섹션을 `ct` 명령어 기준으로 업데이트.

### Notes
- Backward compatibility concerns: 기존 스크립트 사용자들을 위해 구형 진입점(`generator/cli.py` 등)을 바로 삭제하지는 않음.
- Refactoring risk: 각 하위 모듈의 CLI 코드가 `if __name__ == "__main__":` 블록 내에만 있다면, 함수 형태로 리팩토링하여 외부에서 호출 가능하게 만들어야 할 수도 있음.

---

## 5. Docs / Notes

### README Updates
- 추가 또는 수정할 섹션: "Getting Started"
- 전달하고자 하는 핵심 메시지: "이제 `ct` 명령어 하나로 데이터 생성부터 평가까지 수행할 수 있습니다."

### Example Snippet (Optional)

```bash
# 데이터셋 생성
ct gen --input raw_data.jsonl --output-dir datasets/

# 실행 (Runner)
ct run --dataset-id my_dataset_v1 --backend openai

# 평가 (Evaluator)
ct eval --run-id run_20250212_1000
```
