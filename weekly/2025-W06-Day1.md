# Daily Framework Planning – 2025-W06-Day1

> Repository: chatbot-tester
> Type: Library / SDK (Generator · Runner · Evaluator)
> Cadence: Daily (주차 내 일차별 사고 기록)
> Focus: Architecture, API design, extensibility, reproducibility

---

## Language Rule (MANDATORY)

- 본 문서의 **모든 내용은 반드시 한국어로 작성**합니다.
- 다음 항목만 예외적으로 영어 사용을 허용합니다:
  - 코드 블록
  - 파일 경로
  - 함수명 / 클래스명 / 모듈명
  - CLI 커맨드
  - 고유 명사 (예: OpenAI, CLI, SDK, Generator, Runner, Evaluator)
- 번역체가 아닌 **기술 기획 문서에 적합한 자연스러운 한국어**를 사용합니다.

---

## 1. Discovery (Ideas)

> Goal: 재사용 가능한 SDK 관점에서의 프레임워크 수준 개선 아이디어를
> **하루 단위로 축적**한다.

### Idea 1
- Affected layer: Common (Generator / Runner / Evaluator)
- Current limitation: 각 모듈(`generator`, `runner`, `evaluator`)이 서로 다른 설정 방식(Dataclass, Pydantic, Hardcoded args)을 사용하고 있어, 전체 파이프라인을 한 번에 실행하거나 재현하기 어렵습니다.
- Proposed improvement: 전체 실험(Experiment)을 정의하는 통일된 구성 스키마(Unified Configuration Schema)를 도입하여 YAML 파일 하나로 전체 흐름을 제어하도록 개선합니다.
- Why this matters for an SDK: 사용자 입장에서 실험의 재현성을 보장하고, CLI 명령어를 단순화할 수 있습니다.

### Idea 2
- Affected layer: Generator
- Current limitation: `pipeline.py`의 데이터 로딩 및 처리 로직이 동기식(Synchronous)으로 구현되어 있어, 대규모 합성 데이터 생성 시 I/O 병목이 발생할 수 있습니다.
- Proposed improvement: `asyncio`를 활용하여 데이터 로더와 생성 파이프라인을 비동기 처리 구조로 리팩토링합니다.
- Why this matters for an SDK: 대규모 데이터셋 처리 성능을 개선하고, `Runner`와의 구조적 통일성을 확보할 수 있습니다.

### Idea 3
- Affected layer: Common / Core
- Current limitation: 중간 산출물(생성된 jsonl, 실행 결과 등)의 경로 관리가 수동으로 이루어져, 파이프라인 단계 간 데이터 연결이 번거롭고 실수하기 쉽습니다.
- Proposed improvement: `ArtifactManager`를 도입하여 실험 ID 기반으로 모든 중간 파일의 경로와 버전을 자동으로 관리합니다.
- Why this matters for an SDK: 사용자가 파일 경로를 신경 쓰지 않고 논리적인 단계(Step)에만 집중할 수 있게 합니다.

### Idea 4
- Affected layer: Common
- Current limitation: `Runner`의 `backend_registry`와 `Evaluator`의 `MetricRegistry`가 별도로 구현되어 있으며, `Generator`는 레지스트리 패턴이 적용되지 않았습니다.
- Proposed improvement: `chatbot_tester.core` 레벨에서 통일된 `PluginRegistry`를 제공하여 모든 모듈이 동일한 방식으로 확장을 지원하도록 합니다.
- Why this matters for an SDK: 서드파티 확장을 개발하는 사용자에게 일관된 경험을 제공합니다.

### Idea 5
- Affected layer: All
- Current limitation: 실행 과정의 모니터링이나 로깅이 각 모듈별로 파편화되어 있어, 전체 파이프라인의 진행 상황을 통합적으로 파악하거나 외부 도구(WandB 등)와 연동하기 어렵습니다.
- Proposed improvement: 전역적인 이벤트 버스(Event Bus) 또는 Callback 시스템을 도입하여 주요 생명주기(Lifecycle) 이벤트를 훅(Hook)할 수 있게 합니다.
- Why this matters for an SDK: 관측 가능성(Observability)을 높이고 MLOps 도구와의 통합을 용이하게 합니다.

---

## 2. Triage

> Goal: **오늘 기준** 가장 아키텍처적 파급력이 큰 1개 아이디어를 선정한다.

### Selected Idea
- Title: Unified Experiment Profile (통합 실험 구성 스키마)
- Primary affected layer(s): Common / All

### Selection Rationale
- Architectural leverage: 개별 모듈의 독립성을 해치지 않으면서, 상위 레벨에서 이들을 엮어주는 오케스트레이션 레이어를 정의하는 작업이므로 아키텍처적으로 가장 중요합니다.
- Impact on extensibility / reuse: 실험 설정을 코드가 아닌 데이터(YAML)로 분리함으로써, 다양한 실험 시나리오를 쉽게 공유하고 재사용할 수 있습니다.
- Reduction of future complexity: 향후 추가될 기능들(CLI 통합, 리포팅 등)이 이 통합 설정 구조를 기반으로 개발될 수 있어 장기적인 복잡도를 낮춥니다.

### Deferred Ideas (Brief)
- Idea 2 (Async Generator): 성능 최적화 이슈로, 구조적 변경보다는 구현 상세에 가까워 우선순위를 낮춥니다.
- Idea 3 (Artifact Manager): 통합 설정이 먼저 정의되어야 파일 경로 관리 정책도 수립할 수 있으므로 연기합니다.

---

## 3. Spec Draft (Top 1 Only)

### Feature / Improvement Name
Unified Experiment Profile (실험 프로필 통합 구성)

### Problem Statement
- 현재 어떤 점이 어렵거나, 불명확하거나, 오류를 유발하는가?
  - 사용자는 데이터 생성, 실행, 평가를 위해 각각 다른 CLI 명령어와 인자를 조합해야 하며, 이 과정에서 설정 불일치(예: 데이터셋 ID 오기입)나 누락이 발생하기 쉽습니다.
- 누구에게 영향을 주는가? (라이브러리 사용자 / CLI 사용자 / 프레임워크 유지보수자)
  - CLI 사용자: 복잡한 명령어를 매번 입력해야 함.
  - 라이브러리 사용자: 전체 파이프라인을 코드로 구성할 때 보일러플레이트 코드가 증가함.

### Design Approach (High-level)
- Core concept: `ExperimentProfile`이라는 최상위 설정 객체를 정의합니다. 이 객체는 `generator`, `runner`, `evaluator` 섹션을 포함하며, 각 단계의 설정을 캡슐화합니다.
- Key abstractions or interfaces:
  - `ExperimentProfile` (Pydantic Model)
  - `ExperimentConfigLoader`: YAML/JSON 파일을 읽어 검증된 설정 객체로 변환
- Expected behavior:
  - 사용자는 `experiment.yaml` 파일을 작성합니다.
  - `chatbot-tester run experiment.yaml` 명령어 하나로 생성 -> 실행 -> 평가의 전 과정을 순차적으로(혹은 선택적으로) 수행할 수 있습니다.

### MVP Scope
- Included in MVP:
  - `ExperimentProfile` Pydantic 모델 정의
  - 기존 `PipelineOptions`, `RunnerOptions`, `EvaluatorConfig`를 포함하는 래퍼(Wrapper) 구조 설계
  - YAML 파일 로딩 및 검증 로직
- Explicitly excluded:
  - `chatbot-tester run` CLI 명령어 구현 (별도 태스크로 진행)
  - Artifact 자동 관리 (사용자가 경로를 명시해야 함)

### Optional / Future Extensions
- 환경 변수 치환 (${ENV_VAR}) 지원
- 다른 설정 파일 상속(Inheritance) 또는 포함(Include) 기능

### Acceptance Criteria
- [ ] `src/chatbot_tester/core/config.py` (신규)에 통합 설정 모델이 정의됨
- [ ] `generator`, `runner`, `evaluator`의 설정을 하나의 YAML 파일로 로드할 수 있음
- [ ] 로드된 설정 객체가 각 하위 모듈의 설정 객체로 올바르게 변환/매핑됨을 단위 테스트로 검증함

---

## 4. Backlog Draft (Issue-Level)

### Suggested GitHub Issue Title
`[Framework][Config] 통합 실험 구성을 위한 Experiment Profile 스키마 설계`

### Task Breakdown
- [ ] Core implementation
  - Module: `chatbot_tester.core` (신규 패키지 또는 기존 위치 활용)
  - Summary: `ExperimentProfile` Pydantic 모델 및 YAML 로더 구현. 기존 `PipelineOptions`(Dataclass)와 `EvaluatorConfig`(Pydantic)를 수용할 수 있는 어댑터 구조 포함.
- [ ] CLI changes (if any)
  - Command: N/A (이번 변경은 스키마 정의에 집중)
  - Flags / options: N/A
- [ ] API impact
  - Breaking change: No (기존 모듈은 그대로 유지, 상위 레이어 추가)
  - Migration needed: No
- [ ] Tests
  - Unit / Integration: `tests/core/test_config.py` 작성하여 복합 YAML 파일 파싱 및 유효성 검사 테스트.
- [ ] Documentation
  - README / Examples / Docstrings: `example/experiment_config.yaml` 예제 파일 추가.

### Notes
- Backward compatibility concerns: 기존 개별 CLI 및 설정 방식은 그대로 유지해야 함.
- Refactoring risk: `generator/pipeline.py`의 `PipelineOptions`가 순수 Dataclass이므로 Pydantic과의 호환성 고려 필요 (Pydantic의 `dataclasses` 호환 기능 활용).

---

## 5. Docs / Notes

### README Updates
- 추가 또는 수정할 섹션: "Experiment Configuration" 섹션 신설
- 전달하고자 하는 핵심 메시지: "복잡한 파이프라인을 단일 YAML 파일로 정의하여 실험을 자동화하고 재현성을 확보하세요."

### Example Snippet (Optional)

```yaml
# example/experiment_sample.yaml
version: "1.0"
name: "my-first-experiment"

generator:
  input_path: "./data/raw_inputs.csv"
  output_dir: "./data/generated"
  sample_size: 100

runner:
  backend: "openai-gpt-4"
  max_concurrency: 5
  timeout_seconds: 30

evaluator:
  metrics:
    - type: "accuracy"
    - type: "latency"
  report:
    formats: ["html", "json"]
```
