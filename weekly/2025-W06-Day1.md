# Daily Framework Planning – 2025-W06-Day1

> Repository: chatbot-tester
> Type: Library / SDK (Generator · Runner · Evaluator)
> Cadence: Daily (주차 내 일차별 사고 기록)
> Focus: Architecture, API design, extensibility, reproducibility

---

## Language Rule (MANDATORY)

- 본 문서의 **모든 내용은 반드시 한국어로 작성**합니다.
- 다음 항목만 예외적으로 영어 사용을 허용합니다:
  - 코드 블록
  - 파일 경로
  - 함수명 / 클래스명 / 모듈명
  - CLI 커맨드
  - 고유 명사 (예: OpenAI, CLI, SDK, Generator, Runner, Evaluator)
- 번역체가 아닌 **기술 기획 문서에 적합한 자연스러운 한국어**를 사용합니다.

---

## 1. Discovery (Ideas)

> Goal: 재사용 가능한 SDK 관점에서의 프레임워크 수준 개선 아이디어를
> **하루 단위로 축적**한다.

### Idea 1
- Affected layer: Common, Generator, Runner
- Current limitation: `runner`와 `generator`가 서로 다른 `Message`, `TestSample` 정의를 가지고 있어 코드 중복이 발생하고, 모듈 간 데이터 교환 시 타입 호환성 문제가 존재함.
- Proposed improvement: `src/chatbot_tester/common/models.py`를 생성하여 핵심 데이터 모델을 통합하고, 각 모듈이 이를 참조하도록 리팩터링함.
- Why this matters for an SDK: 단일 진실 공급원(Single Source of Truth)을 확립하여 유지보수성을 높이고, 모듈 간 상호운용성(Interoperability)을 보장함.

### Idea 2
- Affected layer: Runner, Generator, Evaluator
- Current limitation: 실험 설정이 CLI 플래그, 환경 변수, 설정 파일 등으로 분산되어 있어, 복잡한 실험 시나리오를 재현하기 어려움.
- Proposed improvement: 데이터 생성부터 실행, 평가까지의 전체 파이프라인을 기술하는 통합 실험 프로필(Unified Experiment Profile) YAML 스키마 및 로더 구현.
- Why this matters for an SDK: 실험 구성을 코드로 관리(Infrastructure as Code)할 수 있게 하여, 사용자가 복잡한 실험을 쉽게 공유하고 재현할 수 있게 함.

### Idea 3
- Affected layer: Common, Runner
- Current limitation: 실행 진행 상황이나 내부 상태 변화를 외부에서 모니터링하기 어려우며, 로깅 시스템이 각 모듈에 강결합되어 있음.
- Proposed improvement: 발행-구독(Pub-Sub) 패턴의 경량 이벤트 버스(Event Bus)를 도입하여 로깅, 진행률 표시, 메트릭 수집을 비즈니스 로직에서 분리함.
- Why this matters for an SDK: 라이브러리 사용자가 자신만의 로거나 UI 훅을 쉽게 등록할 수 있게 하여 확장성을 높임.

### Idea 4
- Affected layer: Runner
- Current limitation: 새로운 LLM 백엔드를 추가하려면 `Runner`의 코어 코드를 직접 수정해야 함.
- Proposed improvement: `Evaluator`의 메트릭 레지스트리와 유사한 백엔드 자동 등록/검증 시스템을 도입하여 플러그인 구조로 전환함.
- Why this matters for an SDK: 코어 코드 수정 없이 커뮤니티나 사용자가 새로운 모델/API 지원을 확장할 수 있음.

### Idea 5
- Affected layer: CLI
- Current limitation: `python -m chatbot_tester.runner`, `generator` 등 모듈별로 실행 방식이 파편화되어 있어 사용자 경험이 좋지 않음.
- Proposed improvement: `ct` 또는 `chatbot-tester`라는 단일 명령어로 하위 기능(run, gen, eval)을 호출하는 통합 CLI 진입점 제공.
- Why this matters for an SDK: 사용자에게 일관된 인터페이스를 제공하여 학습 비용을 낮추고 사용성을 개선함.

---

## 2. Triage

> Goal: **오늘 기준** 가장 아키텍처적 파급력이 큰 1개 아이디어를 선정한다.

### Selected Idea
- Title: `chatbot_tester.common` 패키지 신설 및 코어 모델 통합
- Primary affected layer(s): Common

### Selection Rationale
- Architectural leverage: 순환 참조 문제를 원천적으로 방지하고, 이후 통합 프로필이나 이벤트 버스 구현의 기반이 됨.
- Impact on extensibility / reuse: `Generator`가 생성한 데이터를 `Runner`가 즉시 이해할 수 있는 구조적 기반을 마련함.
- Reduction of future complexity: 중복된 데이터 클래스 정의를 제거하여 타입 불일치로 인한 버그 발생 가능성을 낮춤.

### Deferred Ideas (Brief)
- Unified Experiment Profile: 모델 통합이 선행되어야 설정 객체도 통합 가능하므로 연기함.
- Event Bus: 현재 단계에서는 필수적이지 않으며, 구조적 정리가 우선임.

---

## 3. Spec Draft (Top 1 Only)

### Feature / Improvement Name
`chatbot_tester.common` 패키지 신설 및 코어 모델 통합

### Problem Statement
- 현재 `runner/models.py`, `generator/types.py`에서 `Message`, `TestSample` 등 핵심 데이터 구조가 중복 정의되어 있음.
- `Evaluator` 또한 유사하지만 조금 다른 구조를 사용하고 있어 데이터 파이프라인 연결 시 변환 비용이 발생함.
- 라이브러리 유지보수자가 동일한 로직을 여러 번 수정해야 하는 비효율이 존재함.

### Design Approach (High-level)
- Core concept: 모든 모듈이 공통으로 의존하는 `common` 패키지를 최하단 레이어로 배치.
- Key abstractions or interfaces:
  - `src/chatbot_tester/common/models.py`: `Message`, `TestSample` 등 핵심 DTO(Data Transfer Object) 정의.
- Expected behavior: 기존 모듈들은 `common`에서 모델을 임포트하여 사용하며, 외부 인터페이스(JSON 직렬화 포맷 등)는 동일하게 유지됨.

### MVP Scope
- Included in MVP:
  - `src/chatbot_tester/common/` 패키지 생성
  - `Message`, `TestSample` 클래스 이관
  - `Runner`, `Generator`의 참조 코드 리팩터링
- Explicitly excluded:
  - `Evaluator`의 `TestSampleRecord` 통합 (필드 구조가 상이하여 별도 매핑 로직 필요하므로 추후 진행)
  - 백엔드 구현체 등 로직이 포함된 클래스 이관

### Optional / Future Extensions
- `RunResult`, `RunConfig` 등 실행 관련 모델 통합
- `Evaluator` 도메인 모델과의 통합 어댑터 구현

### Acceptance Criteria
- [ ] `src/chatbot_tester/common/models.py`가 존재하고 핵심 클래스가 정의됨
- [ ] `runner`와 `generator`의 기존 테스트가 수정 없이(혹은 import 경로 수정만으로) 통과함
- [ ] 모듈 간 순환 참조 에러가 발생하지 않음

---

## 4. Backlog Draft (Issue-Level)

### Suggested GitHub Issue Title
`[Framework][Daily][2025-W06-Day1] Core Data Models(Message, TestSample)를 common 패키지로 통합`

### Task Breakdown
- [ ] Core implementation
  - Module: `chatbot_tester.common`
  - Summary: `models.py` 생성 및 `runner/models.py`, `generator/types.py`의 중복 코드 이관.
- [ ] CLI changes (if any)
  - Command: N/A
  - Flags / options: N/A
- [ ] API impact
  - Breaking change: No (내부 임포트 경로만 변경되나, 라이브러리 사용자에게 노출된 경로가 있다면 alias 처리 필요)
  - Migration needed: No
- [ ] Tests
  - Unit / Integration: 기존 유닛 테스트 수행으로 검증.
- [ ] Documentation
  - README / Examples / Docstrings: 개발자 가이드에 모듈 의존성 구조 업데이트.

### Notes
- Backward compatibility concerns: `chatbot_tester.runner.models`를 임포트해서 쓰는 사용자가 있을 수 있으므로, 해당 파일에서 `from ..common.models import *` 형태로 호환성 유지 필요.
- Refactoring risk: 대규모 파일 이동이므로 Git 충돌 주의.

---

## 5. Docs / Notes

### README Updates
- 추가 또는 수정할 섹션: Architecture / Module Structure
- 전달하고자 하는 핵심 메시지: `common` 패키지는 모든 모듈이 공유하는 기본 데이터 타입을 정의합니다.

### Example Snippet (Optional)

```python
# src/chatbot_tester/runner/models.py
# 하위 호환성을 위해 common에서 가져옴
from chatbot_tester.common.models import Message, TestSample

__all__ = ["Message", "TestSample"]
```
