# Daily Framework Planning – 2025-W05-Day1

> Repository: chatbot-tester
> Type: Library / SDK (Generator · Runner · Evaluator)
> Cadence: Daily (주차 내 일차별 사고 기록)
> Focus: Architecture, API design, extensibility, reproducibility

---

## Language Rule (MANDATORY)

- 본 문서의 **모든 내용은 반드시 한국어로 작성**합니다.
- 다음 항목만 예외적으로 영어 사용을 허용합니다:
  - 코드 블록
  - 파일 경로
  - 함수명 / 클래스명 / 모듈명
  - CLI 커맨드
  - 고유 명사 (예: OpenAI, CLI, SDK, Generator, Runner, Evaluator)
- 번역체가 아닌 **기술 기획 문서에 적합한 자연스러운 한국어**를 사용합니다.

---

## 1. Discovery (Ideas)

> Goal: 재사용 가능한 SDK 관점에서의 프레임워크 수준 개선 아이디어를
> **하루 단위로 축적**한다.

### Idea 1
- Affected layer: Common
- Current limitation: `Message`, `TestSample` 등 핵심 데이터 모델이 `generator`와 `runner` 모듈에 중복 정의되어 있어, 컴포넌트 간 데이터 전달 시 변환이 필요하고 불일치 위험이 있음.
- Proposed improvement: `chatbot_tester.common` 패키지를 신설하고 모델을 통합하여 정의함.
- Why this matters for an SDK: 컴포넌트 간 명확한 데이터 계약(Contract)을 제공하여 확장성과 유지보수성을 높임.

### Idea 2
- Affected layer: Common / Runner
- Current limitation: `ChatBackend` 및 레지스트리가 `runner`에 종속되어 있어, `generator`의 데이터 증강(Augmentation)이나 `evaluator`의 LLM 기반 평가(LLM-as-a-judge)에서 재사용하기 어려움.
- Proposed improvement: 백엔드 인터페이스와 레지스트리를 `common`으로 이동시켜 모든 모듈에서 LLM 접근을 표준화함.
- Why this matters for an SDK: LLM 연결 로직의 중복을 제거하고, 서드파티 확장이 프레임워크 전체에서 일관되게 동작하도록 함.

### Idea 3
- Affected layer: CLI / Orchestrator
- Current limitation: 현재 개별 모듈 단위 CLI(`python -m chatbot_tester.generator.cli` 등)만 존재하여, 전체 워크플로우 실행 시 사용자 경험이 파편화됨.
- Proposed improvement: 단일 진입점 명령어 `ct` (또는 `chatbot-tester`)를 도입하고, 하위 명령어(`run`, `gen`, `eval` 등) 구조로 개편함.
- Why this matters for an SDK: 사용성 개선 및 도구의 정체성을 통합함.

### Idea 4
- Affected layer: Evaluator
- Current limitation: 리포트 생성 로직(`HtmlReporter`)이 `jinja2` 템플릿에 강결합되어 있어, 사용자가 자신만의 리포트 스타일이나 형식을 정의하기 어려움.
- Proposed improvement: 커스텀 템플릿 경로를 지원하거나 리포터 인터페이스를 개방하여 사용자 정의 리포팅 시스템을 허용함.
- Why this matters for an SDK: 다양한 비즈니스 요구사항에 맞는 결과물 생성을 지원함.

### Idea 5
- Affected layer: Common
- Current limitation: 로깅 포맷과 상세 수준이 모듈마다 제각각이며, 실행 과정의 구조적 이벤트(Event)를 외부에서 구독하거나 추적하기 어려움.
- Proposed improvement: 구조화된 로깅 및 간단한 이벤트 버스(Event Bus) 패턴을 도입하여 관찰 가능성(Observability)을 확보함.
- Why this matters for an SDK: CI/CD 통합 및 디버깅 용이성을 제공함.

---

## 2. Triage

> Goal: **오늘 기준** 가장 아키텍처적 파급력이 큰 1개 아이디어를 선정한다.

### Selected Idea
- Title: `chatbot_tester.common` 패키지 신설 및 데이터 모델 통합
- Primary affected layer(s): Common, Generator, Runner

### Selection Rationale
- Architectural leverage: 프레임워크의 기반이 되는 데이터 구조를 통일함으로써, 향후 계획된 파이프라인 통합이나 백엔드 공유의 선결 조건을 만족시킴.
- Impact on extensibility / reuse: 단일 진실 공급원(SSOT)을 제공하여 순환 참조 문제를 해결하고 코드 중복을 제거함.
- Reduction of future complexity: 각 모듈이 독립적으로 발전하더라도 데이터 교환 규격이 유지되므로 복잡도를 낮출 수 있음.

### Deferred Ideas (Brief)
- Idea 2 (Backend Share): 모델 통합이 선행되어야 백엔드 인터페이스의 입출력 타입도 명확해지므로 다음 순위로 미룸.
- Idea 3 (CLI Unified): 기능적 통합(오케스트레이터)이 안정화된 후 UX 개선 차원에서 진행하는 것이 효율적임.

---

## 3. Spec Draft (Top 1 Only)

### Feature / Improvement Name
**Common Package & Model Unification**

### Problem Statement
- 현재 `generator/types.py`와 `runner/models.py`에 `Message`, `TestSample` 등 유사한 클래스가 중복 정의되어 있습니다.
- 이로 인해 모듈 간 데이터 이동 시 불필요한 변환 로직이 필요하며, 한쪽의 변경 사항이 다른 쪽에 반영되지 않아 버그를 유발할 수 있습니다.
- 프레임워크 유지보수자와 이를 확장하려는 개발자에게 혼란을 줍니다.

### Design Approach (High-level)
- Core concept: 모든 모듈이 공유하는 기본 데이터 타입과 유틸리티를 담는 `src/chatbot_tester/common` 패키지를 생성합니다.
- Key abstractions or interfaces:
  - `Message`: 역할(role)과 내용(content)을 담는 기본 대화 단위.
  - `TestSample`: 입력, 기대 출력, 메타데이터 등을 포함하는 테스트 케이스 단위.
- Expected behavior: `generator`, `runner`, `evaluator`는 모두 `common.models`에서 정의된 클래스를 임포트하여 사용하며, 별도의 타입 변환 없이 객체를 주고받을 수 있어야 합니다.

### MVP Scope
- Included in MVP:
  - `src/chatbot_tester/common/` 디렉토리 및 `__init__.py` 생성.
  - `src/chatbot_tester/common/models.py`: `Message`, `TestSample` 클래스 정의 (Pydantic 또는 dataclass 활용).
  - `src/chatbot_tester/generator/types.py` 및 `runner/models.py`의 중복 정의 제거 및 import 변경.
  - 기존 테스트 코드 수정.
- Explicitly excluded:
  - `ChatBackend` 등 로직이 포함된 컴포넌트의 이동 (추후 진행).
  - 구성(Config) 관련 클래스 통합 (추후 진행).

### Optional / Future Extensions
- `common/exceptions.py`: 공통 예외 클래스 정의.
- `common/utils.py`: 파일 I/O 등 공통 유틸리티 이동.

### Acceptance Criteria
- [ ] `src/chatbot_tester/common` 패키지가 생성됨.
- [ ] `generator`와 `runner`가 동일한 `Message`, `TestSample` 클래스를 참조함.
- [ ] 기존 유닛 테스트가 수정 없이(또는 최소한의 수정으로) 통과함.
- [ ] 순환 참조 오류가 발생하지 않음.

---

## 4. Backlog Draft (Issue-Level)

### Suggested GitHub Issue Title
`[Framework][Daily][2025-W05-Day1] Create common package and consolidate data models`

### Task Breakdown
- [ ] Core implementation
  - Module: `src/chatbot_tester/common/models.py`
  - Summary: `Message`, `TestSample` 클래스를 구현(Pydantic/dataclasses). `from_dict`, `to_dict` 등 직렬화 메서드 포함.
- [ ] Refactoring
  - Module: `generator/types.py`, `runner/models.py`
  - Summary: 기존 클래스 삭제 및 `common` 임포트로 대체. 관련 코드 수정.
- [ ] API impact
  - Breaking change: Yes (내부 API 변경).
  - Migration needed: Yes (라이브러리 사용자라면 import 경로 변경 필요).
- [ ] Tests
  - Unit / Integration: 변경된 import 경로를 반영하여 기존 테스트 실행 및 검증.
- [ ] Documentation
  - README / Examples / Docstrings: 개발자 가이드에 공통 패키지 구조 설명 추가.

### Notes
- Backward compatibility concerns: 내부 모듈 구조 변경이므로 공개 API로서의 영향도를 체크해야 함.
- Refactoring risk: `pydantic` 버전이나 직렬화 방식의 차이로 인한 미묘한 동작 변화 주의.

---

## 5. Docs / Notes

### README Updates
- 추가 또는 수정할 섹션: "Development Guide" 또는 "Architecture"
- 전달하고자 하는 핵심 메시지: "`chatbot_tester.common`은 프레임워크 전반에서 사용되는 공유 모델과 유틸리티를 포함합니다."

### Example Snippet (Optional)

```python
from chatbot_tester.common.models import Message, TestSample

# Common 모델 사용 예시
msg = Message(role="user", content="Hello")
sample = TestSample(id="1", messages=[msg])
```
